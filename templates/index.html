<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viral Hunter</title>
    <style>
        :root { --bg: #000; --primary: #FE2C55; --secondary: #25F4EE; --text: #fff; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; text-align: center;}
        h1 { background: linear-gradient(45deg, var(--secondary), var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; margin-bottom: 5px; }
        
        .hunt-btn { background: linear-gradient(45deg, var(--primary), #d62446); color: white; border: none; padding: 15px 40px; font-weight: bold; border-radius: 30px; cursor: pointer; margin-top: 20px; width: 100%; max-width: 300px; font-size: 1.1rem;}
        .hunt-btn:disabled { opacity: 0.6; cursor: wait; }
        
        .download-btn { background: #222; color: var(--secondary); border: 2px solid var(--secondary); padding: 10px 20px; font-weight: bold; border-radius: 10px; cursor: pointer; margin-top: 15px; width: 100%; max-width: 300px; display: none; text-decoration: none; display: block; margin: 15px auto;}
        .download-btn:hover { background: var(--secondary); color: #000; }

        .video-wrapper { margin-top: 20px; width: 100%; max-width: 350px; display: none; border: 1px solid #333; border-radius: 10px; overflow: hidden; }
        video { width: 100%; display: block; }
        
        .caption-box { background: #111; padding: 15px; text-align: left; font-family: monospace; font-size: 0.9rem; border-top: 1px solid #333; }
        .loader { display: none; margin-top: 20px; font-size: 1.5rem; animation: spin 1s infinite linear; }
        .error-msg { color: #ff4757; margin-top: 20px; display: none; }
        .success-msg { color: #2ecc71; margin-top: 10px; display: none; font-weight: bold;}
        
        @keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
    </style>
</head>
<body>
    <h1>VIRAL HUNTER</h1>
    <p>Source : Archive.org</p>

    <button class="hunt-btn" id="startBtn" onclick="startHunt()">LANCER LA CHASSE üöÄ</button>
    <div class="loader" id="loader">üìö Recherche dans les archives...</div>
    
    <div class="success-msg" id="successMsg"></div>
    <div class="error-msg" id="errorMsg"></div>

    <div class="video-wrapper" id="resultContainer" style="display:none;">
        <video id="resultVideo" controls playsinline loop></video>
        
        <!-- BOUTON DE SECOURS -->
        <a id="dlLink" href="#" class="download-btn">üì• T√âL√âCHARGER MP4</a>
        
        <div class="caption-box" id="captionText"></div>
    </div>

    <script>
        async function startHunt() {
            const btn = document.getElementById('startBtn');
            const loader = document.getElementById('loader');
            const resultContainer = document.getElementById('resultContainer');
            const errorMsg = document.getElementById('errorMsg');
            const successMsg = document.getElementById('successMsg');
            const dlLink = document.getElementById('dlLink');

            btn.disabled = true;
            loader.style.display = "block";
            resultContainer.style.display = "none";
            errorMsg.style.display = "none";
            successMsg.style.display = "none";

            try {
                const response = await fetch('/run_bot', { method: 'POST' });
                const data = await response.json();

                if (data.status === 'success' || data.status === 'warning') {
                    resultContainer.style.display = "block";
                    document.getElementById('captionText').innerText = data.caption;
                    
                    const videoPlayer = document.getElementById('resultVideo');
                    videoPlayer.src = data.video_url + "?t=" + Date.now();
                    videoPlayer.load();

                    // Configuration du bouton de secours
                    dlLink.href = data.download_url;
                    dlLink.style.display = "block";

                    successMsg.innerText = "‚úÖ " + data.message;
                    successMsg.style.display = "block";
                } else {
                    errorMsg.innerText = "‚ùå " + data.message;
                    errorMsg.style.display = "block";
                }
            } catch (err) {
                errorMsg.innerText = "‚ùå Erreur : " + err;
                errorMsg.style.display = "block";
            } finally {
                loader.style.display = "none";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>


